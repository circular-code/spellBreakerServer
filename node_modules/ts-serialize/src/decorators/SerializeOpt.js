"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var scalts_1 = require("scalts");
var transformers_1 = require("../transformers");
var Serialize_1 = require("./Serialize");
var NoneJsValue = null;
var SerializeOpt = function SerializeOpt(type, jsonPropertyName) {
    var unmarshaller = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : transformers_1.defaultUnmarshaller;
    var marshaller = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : transformers_1.defaultMarshaller;

    var optUnmarshaller = function optUnmarshaller(jsValue, json, clazz, jsonPropertyName, classPropertyName, target, mbType, jsonPath, classPath) {
        return scalts_1.Optional.apply(jsValue).fold(function () {
            return scalts_1.Right(scalts_1.None);
        }, function (value) {
            return unmarshaller(value, json, clazz, jsonPropertyName, classPropertyName, target, mbType, jsonPath, classPath).fold(function (e) {
                return scalts_1.Left(e);
            }, function (v) {
                return scalts_1.Right(scalts_1.Some(v));
            });
        });
    };
    var optMarshaller = function optMarshaller(value, json, clazz, jsonPropertyName, classPropertyName, target, mbType) {
        if (value.isEmpty) {
            return NoneJsValue;
        } else {
            return marshaller(value.get(), json, clazz, jsonPropertyName, classPropertyName, target, mbType);
        }
    };
    return Serialize_1.default(jsonPropertyName, optUnmarshaller, optMarshaller, scalts_1.Some(type));
};
exports.default = SerializeOpt;