"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
var scalts_1 = require("scalts");
var transformers_1 = require("../transformers");
var UnmarshallError_1 = require("../errors/UnmarshallError");
var Serialize_1 = require("./Serialize");
var utils_1 = require("../utils");
exports.SerializeArray = function (type, jsonPropertyName) {
    var unmarshaller = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : transformers_1.defaultUnmarshaller;
    var marshaller = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : transformers_1.defaultMarshaller;

    var arrayUnmarshaller = function arrayUnmarshaller(value, json, clazz, jsonPropertyName, classPropertyName, target, mbType, jsonPath, classPath) {
        if (!Array.isArray(value)) {
            // if there is a default value
            if (utils_1.isDefined(clazz[classPropertyName])) {
                return scalts_1.Right(clazz[classPropertyName]);
            }
            return scalts_1.Left([new UnmarshallError_1.default(value, scalts_1.Some(Array), jsonPropertyName, classPropertyName, target, jsonPath, classPath)]);
        } else {
            return value.reduce(function (acc, curr) {
                if (acc.isLeft) {
                    return acc;
                }
                var currRes = unmarshaller(curr, json, clazz, jsonPropertyName, classPropertyName, target, mbType, jsonPath, classPath);
                if (currRes.isLeft) {
                    return scalts_1.Left(currRes.left().get());
                }
                return scalts_1.Right(acc.right().get().concat(currRes.right().get()));
            }, scalts_1.Right([]));
        }
    };
    var arrayMarshaller = function arrayMarshaller(value, json, clazz, jsonPropertyName, classPropertyName, target, mbType) {
        return value.map(function (v) {
            return marshaller(v, json, clazz, jsonPropertyName, classPropertyName, target, mbType);
        });
    };
    return Serialize_1.default(jsonPropertyName, arrayUnmarshaller, arrayMarshaller, scalts_1.Some(type));
};
exports.default = exports.SerializeArray;